<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>My Profile</title>
        <link rel="stylesheet" href="<?= base_url('assets/css/dashboard-common.css') ?>">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <style>
            .profile-container { max-width: 900px; margin: 2rem auto; background: #fff; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
            .profile-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
            .avatar { width: 56px; height: 56px; border-radius: 50%; background: #4c51bf; color: #fff; display:flex; align-items:center; justify-content:center; font-weight: 700; }
            .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
            .field { display:flex; flex-direction: column; gap: 0.25rem; }
            .field label { font-size: .9rem; color:#4a5568; }
            .field input { padding:.6rem .75rem; border:1px solid #e2e8f0; border-radius:6px; }
            .actions { display:flex; gap:.75rem; margin-top: 1rem; }
            .btn { padding: .6rem 1rem; border-radius: 6px; border:none; cursor:pointer; }
            .btn.primary { background:#4c51bf; color:#fff; }
            .btn.secondary { background:#edf2f7; }
            .card { background:#f7fafc; padding:1rem; border-radius:8px; }
            @media (max-width: 700px){ .grid{ grid-template-columns: 1fr; } }
        </style>
    </head>
    <body>
        <div class="profile-container">
            <div class="profile-header">
                <div class="avatar"><?= strtoupper(substr(\App\Helpers\UserHelper::getDisplayName($currentUser ?? null), 0, 2)) ?></div>
                <div>
                    <div style="font-size:1.1rem; font-weight:700;"><?= \App\Helpers\UserHelper::getDisplayName($currentUser ?? null) ?></div>
                    <div style="opacity: .8; font-size:.9rem;">Role: <?= esc($currentUser['role'] ?? '') ?></div>
                </div>
            </div>

            <form id="profile-form" class="card" onsubmit="return false;">
                <h3 style="margin-bottom:.75rem;">Profile Information</h3>
                <div class="grid">
                    <div class="field">
                        <label>First Name</label>
                        <input type="text" name="first_name" value="<?= esc($currentUser['first_name'] ?? '') ?>">
                    </div>
                    <div class="field">
                        <label>Last Name</label>
                        <input type="text" name="last_name" value="<?= esc($currentUser['last_name'] ?? '') ?>">
                    </div>
                    <div class="field">
                        <label>Username</label>
                        <input type="text" name="username" value="<?= esc($currentUser['username'] ?? '') ?>">
                    </div>
                    <div class="field">
                        <label>Email</label>
                        <input type="email" name="email" value="<?= esc($currentUser['email'] ?? '') ?>">
                    </div>
                    <div class="field">
                        <label>Phone</label>
                        <input type="text" name="phone" value="<?= esc($currentUser['phone'] ?? '') ?>">
                    </div>
                    <div class="field">
                        <label>Department</label>
                        <input type="text" name="department" value="<?= esc($currentUser['department'] ?? '') ?>">
                    </div>
                </div>
                <div class="actions">
                    <button class="btn primary" id="save-profile">Save Profile</button>
                    <a class="btn secondary" href="javascript:history.back()">Back</a>
                </div>
            </form>

            <div class="card" style="margin-top:1rem;">
                <h3 style="margin-bottom:.75rem;">Change Password</h3>
                <form id="password-form" onsubmit="return false;" class="grid">
                    <div class="field">
                        <label>Current Password</label>
                        <input type="password" name="current_password">
                    </div>
                    <div class="field">
                        <label>New Password</label>
                        <input type="password" name="new_password">
                    </div>
                    <div class="field">
                        <label>Confirm New Password</label>
                        <input type="password" name="confirm_password">
                    </div>
                </form>
                <div class="actions">
                    <button class="btn primary" id="save-password">Update Password</button>
                </div>
            </div>

            <div id="profile-message" style="margin-top:1rem;"></div>
        </div>

        <script src="<?= base_url('js/utils.js') ?>"></script>
        <script src="<?= base_url('js/profile.js') ?>"></script>
    </body>
></html>


